"use strict";(self.webpackChunkrancher_ui_devkit=self.webpackChunkrancher_ui_devkit||[]).push([[502],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>c});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,i=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=s(n),c=l,k=d["".concat(p,".").concat(c)]||d[c]||h[c]||i;return n?a.createElement(k,r(r({ref:t},u),{},{components:n})):a.createElement(k,r({ref:t},u))}));function c(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var i=n.length,r=new Array(i);r[0]=d;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:l,r[1]=o;for(var s=2;s<i;s++)r[s]=n[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4917:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>s});var a=n(7462),l=(n(7294),n(3905));const i={},r="Getting Started",o={unversionedId:"plugins/plugins-getting-started",id:"plugins/plugins-getting-started",title:"Getting Started",description:"Use Case: Rancher Dashboard Development",source:"@site/docs/plugins/plugins-getting-started.md",sourceDirName:"plugins",slug:"/plugins/plugins-getting-started",permalink:"/dashboard/plugins/plugins-getting-started",draft:!1,tags:[],version:"current",lastUpdatedAt:1668695244,formattedLastUpdatedAt:"Nov 17, 2022",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Sortable Table",permalink:"/dashboard/code-base-works/sortable-table"},next:{title:"Initializing Plugins",permalink:"/dashboard/plugins/initializing-plugins"}},p={},s=[{value:"Use Case: Rancher Dashboard Development",id:"use-case-rancher-dashboard-development",level:2},{value:"Use Case: Develop a new UI",id:"use-case-develop-a-new-ui",level:2},{value:"Use Case: Develop a UI Package",id:"use-case-develop-a-ui-package",level:2},{value:"Use Case: Dynamically loading a UI Plugin",id:"use-case-dynamically-loading-a-ui-plugin",level:2},{value:"Use Case: Publish a package to NPM",id:"use-case-publish-a-package-to-npm",level:2},{value:"Use Case: Using Yarn link",id:"use-case-using-yarn-link",level:2}],u={toc:s};function h(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"getting-started"},"Getting Started"),(0,l.kt)("h2",{id:"use-case-rancher-dashboard-development"},"Use Case: Rancher Dashboard Development"),(0,l.kt)("p",null,"The goal is to not complicate the development process for Rancher. Although the code has moved around and even once we pull out code into the ",(0,l.kt)("inlineCode",{parentName:"p"},"pkg")," folder, the development\nprocess for Rancher will be the same as it is."),(0,l.kt)("p",null,"You should be able to use ",(0,l.kt)("inlineCode",{parentName:"p"},"yarn dev")," as before - the UI will build and run just as it did pre-2.6.5."),(0,l.kt)("p",null,"You should be able to make changes to code and the UI should hot-reload in the browser."),(0,l.kt)("p",null,"The development workflow for Rancher Dashboard remains unchanged."),(0,l.kt)("h2",{id:"use-case-develop-a-new-ui"},"Use Case: Develop a new UI"),(0,l.kt)("p",null,"This use case covers our need to build separate UIs for ",(0,l.kt)("a",{parentName:"p",href:"https://harvesterhci.io/"},"Harvester"),", ",(0,l.kt)("a",{parentName:"p",href:"https://epinio.io/"},"Epinio")," etc - but wanting to leverage the core of the Rancher Dashboard UI."),(0,l.kt)("p",null,"For this, we would publish the ",(0,l.kt)("inlineCode",{parentName:"p"},"shell")," as an NPM package and leverage it in a new UI project."),(0,l.kt)("p",null,"To help with this, we created an NPM package to help bootstrap a new UI."),(0,l.kt)("p",null,"To demonstrate this use case:"),(0,l.kt)("p",null,"In a new console window, install and run ",(0,l.kt)("a",{parentName:"p",href:"https://verdaccio.org"},"Verdaccio")," (this is a local NPM registry that will allow us to publish and use NPM packages locally without having to push them to the NPM registry):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"yarn global add verdaccio\nverdaccio\n")),(0,l.kt)("p",null,"Now, back in the original console window, run:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"npm adduser --registry http://localhost:4873  (just add a user with username/password: admin/admin)\nyarn publish ./shell/creators/app --patch --registry http://localhost:4873/\nyarn publish ./shell/creators/pkg --patch --registry http://localhost:4873/\n")),(0,l.kt)("p",null,"These steps will publish the two ",(0,l.kt)("a",{parentName:"p",href:"https://classic.yarnpkg.com/en/docs/cli/create"},"creator")," packages to the local npm registry. If you open a browser to ",(0,l.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:4873")," you'll see the two packages there."),(0,l.kt)("p",null,"Now we'll publish the ",(0,l.kt)("inlineCode",{parentName:"p"},"shell")," package."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'PUBLISH_ARGS="--registry http://localhost:4873/" yarn publish-shell \n')),(0,l.kt)("p",null,"At this point, we've published 3 NPM packages:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@rancher/shell")," - the core shell UI that can be incorporated into a new UI to give core functionality"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@rancher/create-app")," - a simple package that can be used with the ",(0,l.kt)("inlineCode",{parentName:"li"},"yarn create")," command to create a new UI"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@rancher/create-pkg")," - a simple package that can be used with the ",(0,l.kt)("inlineCode",{parentName:"li"},"yarn create")," command to create a new UI Package")),(0,l.kt)("p",null,"Now we can create a new UI. First we need to set the environment variable so that yarn will look for packages in our local registry:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"export YARN_REGISTRY=http://127.0.0.1:4873\n")),(0,l.kt)("p",null,"Now we can go ahead and create a new UI."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"cd")," to a folder not within the checkout and run:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"yarn create @rancher/app my-app\ncd my-app\n")),(0,l.kt)("p",null,"This will create a new folder ",(0,l.kt)("inlineCode",{parentName:"p"},"my-app")," and populate it with the miniumum files needed."),(0,l.kt)("p",null,"You can run the app with:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"yarn install\nyarn dev\n")),(0,l.kt)("p",null,"You should be able to open a browser at ",(0,l.kt)("inlineCode",{parentName:"p"},"https://127.0.0.1:8005")," and you'll get the Rancher Dashboard UI."),(0,l.kt)("p",null,"This illustrates being able to share the ",(0,l.kt)("inlineCode",{parentName:"p"},"shell")," across UIs - in practice, we would extract the Rancher code from the shell, so instead of getting the Rancher\nfunctionality in this example, you'd get an empty shell application with the side menu, UI chrome, avatar menu etc."),(0,l.kt)("p",null,"You would now add new functionality to this application by adding new UI Packages."),(0,l.kt)("h2",{id:"use-case-develop-a-ui-package"},"Use Case: Develop a UI Package"),(0,l.kt)("p",null,"So far, we've show that we can re-use the Rancher Shell to support multiple UIs."),(0,l.kt)("p",null,"Next up is the ability to add functionality to a UI. We do this through UI packages."),(0,l.kt)("p",null,"We have a simple ",(0,l.kt)("inlineCode",{parentName:"p"},"yarn create")," helper to do this."),(0,l.kt)("p",null,"Run:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"yarn create @rancher/pkg testplugin\n")),(0,l.kt)("p",null,"This will create a new UI Package in the ",(0,l.kt)("inlineCode",{parentName:"p"},"pkg/testplugin")," folder."),(0,l.kt)("p",null,"Replace the contents of the file ",(0,l.kt)("inlineCode",{parentName:"p"},"pkg/testplugin/index.js")," with:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"import { importTypes } from '@rancher/auto-import';\n\n// Init the package\nexport default function($plugin) {\n  // Auto-import model, detail, edit from the folders\n  importTypes($plugin);\n\n  $plugin.addProduct(require('./product'));\n}\n\n")),(0,l.kt)("p",null,"Next, create a new file ",(0,l.kt)("inlineCode",{parentName:"p"},"pkg/testplugin/product.js")," with this content:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"export function init($plugin, store) {\n  const { product } = $plugin.DSL(store, $plugin.name);\n\n  product({\n    icon:                  'gear',\n    inStore:               'management',\n    removable:             false,\n    showClusterSwitcher:   false,\n  });\n}\n\n")),(0,l.kt)("p",null,"You should now be able to run the UI again with:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"yarn dev\n")),(0,l.kt)("p",null,"Open a web browser to ",(0,l.kt)("a",{parentName:"p",href:"https://127.0.0.1:8005"},"https://127.0.0.1:8005")," and you'll see a new 'Example' nav item in the top-level slide-in menu."),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"testplugin")," package created here doesn't do much other than add a new product to the UI, which results in the new navigation item."),(0,l.kt)("p",null,"The developer experience is still the same - you can edit the code in ",(0,l.kt)("inlineCode",{parentName:"p"},"pkg/testplugin")," and the UI will hot-reload to reflect the updates you make."),(0,l.kt)("h2",{id:"use-case-dynamically-loading-a-ui-plugin"},"Use Case: Dynamically loading a UI Plugin"),(0,l.kt)("p",null,"In the previous use case, the UI package we created was statically built into the UI - this works great for the developer use case where we want to be able to iterate, make changes and see those via hot-reload as we do with Rancher Dashboard today."),(0,l.kt)("p",null,"This use case illustrates being able to build a UI plugin as a package and then be able to load that into the UI, dynamically at run-time."),(0,l.kt)("p",null,"First thing to do is to build the UI package for the ",(0,l.kt)("inlineCode",{parentName:"p"},"testplugin")," plugin that we created previously. Run:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"yarn build-pkg testplugin\n")),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"testplugin")," plugin will be built and the output placed in ",(0,l.kt)("inlineCode",{parentName:"p"},"dist-pkg\\testplugin"),"."),(0,l.kt)("p",null,"Next, edit the ",(0,l.kt)("inlineCode",{parentName:"p"},"nuxt.config.js")," file in the root folder and replace it with this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"import config from './shell/nuxt.config';\n\n// Excludes the following plugins if there's no .env file.\nconst excludes = process.env.EXCLUDES_PKG || 'epinio, rancher-components, testplugin';\n\nexport default config(__dirname, {\n  excludes: excludes.replace(/\\s/g, '').split(','),\n  // excludes: ['fleet', 'example']\n  // autoLoad: ['fleet', 'example']\n});\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"NOTE"),": If you're actively working with Plugins, we can make use of the ",(0,l.kt)("inlineCode",{parentName:"p"},".env")," file instead of hardcoded the excludes in the ",(0,l.kt)("inlineCode",{parentName:"p"},"nuxt.config.js")," file so your changes on the file won't be tracked by Git."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"# First, create the .env file from template\ncp env.example .env\n\n# Then, add the following to the .env file\nEXCLUDES_PKG='epinio, rancher-components, testplugin'\n")),(0,l.kt)("p",null,"What we have done here is add the ",(0,l.kt)("inlineCode",{parentName:"p"},"testplugin")," plugin to the ",(0,l.kt)("inlineCode",{parentName:"p"},"excludes")," configuration - this means that when we build and run the UI, we won't include the ",(0,l.kt)("inlineCode",{parentName:"p"},"testplugin")," plugin."),(0,l.kt)("p",null,"Run the UI with:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"yarn dev\n")),(0,l.kt)("p",null,"Open a web browser to ",(0,l.kt)("inlineCode",{parentName:"p"},"https://127.0.0.1:8005")," and you'll see that the Example nav item is not present - since the plugin was not loaded."),(0,l.kt)("p",null,"Bring in the slide-in menu (click on the hamburger menu in the top-left) and click on 'Plugins'."),(0,l.kt)("p",null,"In the top input box, enter ",(0,l.kt)("inlineCode",{parentName:"p"},"testplugin")," as the Plugin name and click 'Load Plugin' - you should see a notification telling you the plugin was loaded and if you bring in the side menu again, you should see the Example nav item there now."),(0,l.kt)("p",null,"This illustrates dynamically loading a Plugin. Note that when we started the UI, it serves up any plugins in the ",(0,l.kt)("inlineCode",{parentName:"p"},"dist-pkg")," folder under the ",(0,l.kt)("inlineCode",{parentName:"p"},"/pkg")," route of the app - so when we entered the name ",(0,l.kt)("inlineCode",{parentName:"p"},"testplugin")," as the plugin, the UI loaded the plugin from:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"https://127.0.0.1:8005/pkg/testplugin/testplugin.umd.min.js\n")),(0,l.kt)("p",null,"If you copy and paste this URL into a browser, you'll see the Javascript for the plugin."),(0,l.kt)("p",null,"To really convince yourself that the plugin is being dynamically loaded, reload the app in the browser window (the ",(0,l.kt)("inlineCode",{parentName:"p"},"testplugin")," plugin will no longer be loaded). Go to Plugins and in the ",(0,l.kt)("inlineCode",{parentName:"p"},"Plugin URL")," enter the URL above and click ",(0,l.kt)("inlineCode",{parentName:"p"},"Load Plugin")," - the plugin will load again - if you look in the browser developer tools under the network tab, you'll see the plugin being dynamically loaded."),(0,l.kt)("p",null,"If you want to, you can run:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"yarn serve-pkgs\n")),(0,l.kt)("p",null,"This will start a web server on port ",(0,l.kt)("inlineCode",{parentName:"p"},"4500")," that is serving up the plugins in the ",(0,l.kt)("inlineCode",{parentName:"p"},"dist-pkg")," folder - it shows the URLs to use for each of the available packages. You can then load these dynamically into any UI that you have running."),(0,l.kt)("h2",{id:"use-case-publish-a-package-to-npm"},"Use Case: Publish a package to NPM"),(0,l.kt)("p",null,"Building on from the previous use case, we can publish a plugin to NPM."),(0,l.kt)("p",null,"From the top-level folder:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"yarn build-pkg testplugin\ncd dist-pkg/testplugin\nyarn publish --patch\n")),(0,l.kt)("p",null,"Open a web browser and view the Verdaccio UI at ",(0,l.kt)("a",{parentName:"p",href:"http://127.0.0.1:4873"},"http://127.0.0.1:4873")," - you'll see we've published our plugin as a package to the registry."),(0,l.kt)("p",null,"In a new folder, run:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"yarn create @rancher/app test2\ncd test2\nyarn install\n")),(0,l.kt)("p",null,"This will give us a new UI - we can run ",(0,l.kt)("inlineCode",{parentName:"p"},"yarn dev")," and see the UI in the browser - with no plugins."),(0,l.kt)("p",null,"Now we can add our UI package that we published to the local registry with:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"yarn add testplugin\n")),(0,l.kt)("p",null,"Now when we run the app with ",(0,l.kt)("inlineCode",{parentName:"p"},"yarn dev")," and browse to ",(0,l.kt)("a",{parentName:"p",href:"https://127.0.0.1:8005"},"https://127.0.0.1:8005")," you'll see that our ",(0,l.kt)("inlineCode",{parentName:"p"},"testplugin")," plugin has been included in the UI."),(0,l.kt)("p",null,"This supports the use case where we may be developing a UI Package that relies on another UI package - so we can create a skeleton app, add the dependencies we need via NPM and then develop our own plugin in the repository - so the only code we have is the code for out plugin, but we are able to test and run it in a UI locally with the other plugins that it needs."),(0,l.kt)("h2",{id:"use-case-using-yarn-link"},"Use Case: Using Yarn link"),(0,l.kt)("p",null,"Suppose we are creating a new UI - it will include the Rancher Shell code via its npm package, so if we needed to make changes to the shell, we'd have to make those changes, publish them as a new version of the package and update our UI to use it."),(0,l.kt)("p",null,"We can ",(0,l.kt)("inlineCode",{parentName:"p"},"yarn link")," to improve this workflow."),(0,l.kt)("p",null,"With the Dashboard repository checked out, we can:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"cd shell\nyarn link\n")),(0,l.kt)("p",null,"Then, in our other app's folder, we can:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"yarn link @rancher/shell\n")),(0,l.kt)("p",null,"This link the package used by the app to the dashboard source code. We can make changes to the shell code in the Rancher Dashboard repository and the separate app will hot-reload."),(0,l.kt)("p",null,"This allows us to develop a new UI Application and be able to make changes to the Shell - in this use case, we're working against two git repositories, so we need to ensure we commit changes accordingly."))}h.isMDXComponent=!0}}]);